name: Github Actions CICD

on:
    push:
        branches: main

jobs:
    Tests:
        name: Tests 
        runs-on: ubuntu-latest
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          JWT_SECRET: ${{ secrets.JWT_SECRET }}
        steps:
            - run: npm run test

    Deploy:
        runs-on: ubuntu-latest 
        needs: [Tests]
        environment: 
            name: Deploy
        steps:
            - uses: actions/checkout@v2 
            - name: Install Vercel CLI
              run : npm install -g vercel@latest 
            - name: Pull Vercel Environment Information
              run: vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}
            - name: Deploy Project Artifacts to Vercel
              run: vercel deploy --prod --token=${{ secrets.VERCEL_TOKEN }}
      
            
