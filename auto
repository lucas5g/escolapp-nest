#!/bin/bash

message=$1 

npm run lint
status=$?

if [ "$status" != 0 ]; then
    echo "Erro no lint"
    exit 
fi


npm  test
status=$?

if [ "$status" != 0 ]; then
    echo "Erro nos tests"
    exit 
fi


git add .
git commit -m "$message"
git push

source .env
sshpass -p $PASSWORD ssh -t root@128.199.12.79 "\
  source ~/.nvm/nvm.sh &&\
  cd projects/escolapp-nest &&\
  git pull &&\
  npm i &&\
  npm run build &&\
  pm2 restart escolapp-nest --update-env
"
